<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì°œ ëª©ë¡</title>

    <!-- í°íŠ¸ ë° ê¸°ë³¸ ì„¤ì • -->
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Jua&display=swap");

      body {
        margin: 0;
        padding: 0;
        font-family: "Jua", sans-serif;
        background-color: #f8f9fa;
      }

      .app-container {
        display: flex;
        flex-direction: column;
        max-width: 480px;
        margin: 0 auto;
        min-height: 100vh;
        background-color: #ffffff;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      }

      /* ìƒë‹¨ë°” */
      .top-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px;
        border-bottom: 2px solid #f0f0f0;
      }

      .back-btn {
        border: none;
        background: none;
        font-size: 24px;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .back-btn:hover {
        transform: scale(1.1);
      }

      .page-title {
        flex: 1;
        text-align: center;
        font-size: 22px;
        font-weight: bold;
        color: #2d3436;
      }

      .placeholder {
        width: 40px;
      }

      /* ì°œ ëª©ë¡ */
      .favorite-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
        padding: 20px;
      }

      .favorite-item {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 16px;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        background-color: #ffffff;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .favorite-item:hover {
        border-color: #00d2be;
        box-shadow: 0 4px 12px rgba(0, 210, 190, 0.2);
        transform: translateY(-2px);
      }

      .fav-icon {
        font-size: 40px;
        flex-shrink: 0;
      }

      .fav-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .fav-name {
        font-size: 18px;
        font-weight: bold;
        color: #2d3436;
        margin: 0;
      }

      .fav-desc {
        font-size: 14px;
        color: #6c757d;
        margin: 0;
      }

      .fav-rating {
        font-size: 14px;
        color: #ffc107;
      }

      .empty-msg {
        text-align: center;
        margin-top: 100px;
        font-size: 18px;
        color: #adb5bd;
      }
    </style>
  </head>

  <body>
    <div class="app-container">
      <!-- ìƒë‹¨ë°” -->
      <header class="top-bar">
        <button class="back-btn" onclick="history.back()">â†</button>
        <h1 class="page-title">ì°œ ëª©ë¡</h1>
        <div class="placeholder"></div>
      </header>

      <!-- ì°œ ëª©ë¡ -->
      <main id="favoriteList" class="favorite-list"></main>
      <p id="emptyMsg" class="empty-msg" style="display: none">
        ì°œí•œ ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤ ğŸ’”
      </p>
    </div>

    <script>
      // ===========================
      // [1] ë°±ì—”ë“œ APIì—ì„œ ì°œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
      // ===========================
      async function loadFavorites() {
        const list = document.getElementById("favoriteList");
        const emptyMsg = document.getElementById("emptyMsg");

        list.innerHTML = "";

        try {
          const response = await fetch('/favorites');
          
          if (!response.ok) {
            if (response.status === 401) {
              alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
              window.location.href = '/users/firstpage';
              return;
            }
            throw new Error('ì°œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }

          const favorites = await response.json();

          if (favorites.length === 0) {
            emptyMsg.style.display = "block";
            return;
          } else {
            emptyMsg.style.display = "none";
          }

          // ëª©ë¡ ë Œë”ë§
          favorites.forEach((store) => {
            const item = document.createElement("div");
            item.className = "favorite-item";

            item.innerHTML = `
              <div class="fav-icon">ğŸª</div>
              <div class="fav-info">
                <p class="fav-name">${store.store_name}</p>
                <p class="fav-desc">${store.category || "ê°€ê²Œ ì„¤ëª… ì—†ìŒ"}</p>
                <p class="fav-rating">â­ ë¦¬ë·° ${store.reviewCount || 0}ê°œ</p>
              </div>
            `;

            // ===========================
            // [2] ì°œëœ ê°€ê²Œ í´ë¦­ â†’ ìƒì„¸í˜ì´ì§€ ì´ë™
            // ===========================
            item.addEventListener("click", () => {
              window.location.href = `/stores/${store.id}/detail`;
            });

            list.appendChild(item);
          });
        } catch (error) {
          console.error('ì°œ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
          emptyMsg.style.display = "block";
          emptyMsg.textContent = "ì°œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        }
      }

      // ===========================
      // [3] í˜ì´ì§€ ë¡œë“œ ì‹œ ì°œ ëª©ë¡ ë Œë”ë§
      // ===========================
      loadFavorites();
    </script>
  </body>
</html>
